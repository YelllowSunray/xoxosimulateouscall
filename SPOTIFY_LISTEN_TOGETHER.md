# Spotify Listen Together Feature

## 🎵 Overview

The Spotify integration allows **both users** in a video call to search and play music that everyone hears, synchronized across all devices.

## ✨ Features

- 👥 **Collaborative Control**: Both users can choose music
- 🔄 **Synchronized Playback**: Everyone hears the same track at the same time
- 💻 **Desktop Support**: Full Spotify web player
- 📱 **iPhone Support**: Remote control for Spotify app
- 🎮 **Last Action Wins**: Anyone can change the music anytime
- ✅ **Premium Quality**: 320kbps audio directly from Spotify

## 🎯 How It Works

### Desktop Users:
```
Full Spotify Web Player
↓
Search & Play tracks directly in browser
↓
Syncs to other user automatically
```

### iPhone Users:
```
Open Spotify App (must be running)
↓
Control via web browser
↓
Browser sends commands to Spotify app
↓
Syncs to other user automatically
```

## 🚀 Using Listen Together

### Step 1: Enable Listen Together

1. During a video call, look for the Spotify player (bottom-left corner)
2. Click the expand button (^)
3. Toggle **"Listen Together"** checkbox ON
4. Both users should enable this

### Step 2: Choose Music

**Either person can:**
- Click the search icon (🔍)
- Search for any song
- Click a track to play it
- Music plays for BOTH users instantly!

### Step 3: Take Turns or Collaborate

- Person A plays a song → Both hear it
- Person B plays different song → Both hear the new song
- Last action wins!
- Natural conversation: "Check out this song!"

## 📱 Device-Specific Setup

### Desktop (Chrome, Firefox, Edge, Safari):
1. Connect Spotify
2. Log in with Premium account
3. Start using immediately!
4. Full web player with all controls

### iPhone (Safari, Chrome):
1. **Install Spotify app** (if not already)
2. **Open Spotify app** and play any song
3. Keep app running in background
4. Open your web browser
5. Connect Spotify in video call
6. Select your iPhone from device list
7. Now you can search and control from browser!

## 🎮 User Experience Examples

### Scenario 1: Desktop ↔ Desktop
```
Sarah (Desktop): "Let me show you this song!"
                → Searches "The Weeknd"
                → Plays "Blinding Lights"
Mike (Desktop):  Automatically hears "Blinding Lights"

Mike:  "Oh, check this out!"
       → Searches "Daft Punk"
       → Plays "Get Lucky"
Sarah: Automatically hears "Get Lucky"
```

### Scenario 2: Desktop ↔ iPhone
```
Sarah (Desktop): Plays "Hotline Bling"
Mike (iPhone):   Hears it through Spotify app

Mike (iPhone):   Opens browser
                 Searches "Bad Guy"
                 Plays it
Sarah (Desktop): Automatically hears "Bad Guy"
```

### Scenario 3: iPhone ↔ iPhone
```
Both users: Have Spotify app open
            Control from browser
            Music plays through their Spotify apps
            Perfect synchronization!
```

## ⚡ Quick Tips

### For Best Experience:
- ✅ Both enable "Listen Together" mode
- ✅ Use Spotify Premium accounts
- ✅ iPhone users: Keep Spotify app running
- ✅ Good internet connection for both

### Common Actions:
- **Search**: Click 🔍 icon
- **Change song**: Just search and play!
- **Pause**: Either person can pause
- **Volume**: Each controls their own
- **Disconnect**: Click "Disconnect" button

## 🔧 Troubleshooting

### "Listen Together not syncing"
- ✅ Check both users have it enabled
- ✅ Verify both are in the same call
- ✅ Refresh if needed

### iPhone: "No devices found"
- ✅ Open Spotify app
- ✅ Play any song in the app
- ✅ Go back to browser
- ✅ Click "I've Opened Spotify"
- ✅ Select your device from list

### "Music not playing"
- ✅ Verify Spotify Premium active
- ✅ Check internet connection
- ✅ iPhone: Ensure app is running
- ✅ Try refreshing the page

### Sync delay
- Normal: 1-2 second delay
- Due to internet latency
- Both hear same song, just slight offset

## 💡 How Synchronization Works

**Technical Details:**
```
User A plays track
↓
Signal sent via LiveKit Data Channel
↓
User B receives signal
↓
User B's Spotify plays same track
↓
Both hear music directly from Spotify
(Not through call audio!)
```

**Quality:**
- Desktop: 320kbps (Premium quality)
- iPhone: 320kbps through app
- NO quality loss from video call
- Each stream is independent

## ⚠️ Requirements

### Must Have:
- ✅ Spotify Premium account
- ✅ Active subscription
- ✅ Internet connection

### iPhone Additional Requirements:
- ✅ Spotify app installed
- ✅ App running in background
- ✅ Logged into app

## 🎯 Best Practices

### Do:
- ✅ Enable "Listen Together" when you want collaborative music
- ✅ Communicate: "Let me play this song!"
- ✅ Take turns choosing music
- ✅ Keep Spotify app open (iPhone)

### Don't:
- ❌ Rapidly switch songs (give each song time)
- ❌ Close Spotify app (iPhone users)
- ❌ Use without Premium (won't work)

## 🆚 Modes Comparison

### Personal Mode (Listen Together OFF):
- Only you hear your music
- Other person can play their own music
- Independent listening

### Listen Together Mode (Listen Together ON):
- Both hear the same music
- Either can control
- Synchronized experience
- Collaborative DJ session!

## 📊 Feature Summary

| Feature | Desktop | iPhone |
|---------|---------|--------|
| **Search Tracks** | ✅ In browser | ✅ In browser |
| **Play Music** | ✅ Web player | ✅ Via Spotify app |
| **Sync with Others** | ✅ Instant | ✅ Instant |
| **Audio Quality** | 320kbps | 320kbps |
| **Setup Complexity** | Easy | Medium |
| **App Required** | No | Yes |

## 🎉 Enjoy!

Now you can listen to music together during video calls! Both people have equal control to create the perfect soundtrack for your conversation.

Questions? Issues? Check the main README or open an issue!

---

**Premium Tip**: Create a shared playlist with your frequent call partners for quick access to your favorite tracks! 🎵✨

